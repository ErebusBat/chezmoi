#!/bin/bash
UK_SERVICE_ID={{- get (gopassRaw "erebusbat/scripts" | mustFromJson).chezmoi_checker .chezmoi.hostname}}

if [[ -z $UK_SERVICE_ID ]]; then
  echo "No Uptime Kuma service set"
  exit 1
fi

chezmoi verify
if [[ $? -eq 0 ]]; then
  curl -q "http://uptime-kuma.erebusbat.net/api/push/${UK_SERVICE_ID}?status=up&msg=OK&ping="
else
  echo "Chezmoi verify failed; not notifying UptimeKuma"
fi
