#!/bin/zsh
# vim: ft=zsh sw=2 ts=2 et

STATIC_FILE=/tmp/wezterm-wallpaper.static
CONFIG_FILE=~/.config/Wezterm/wezterm.lua
WALLPAPER_LUA_FILE=~/.config/wezterm/wallpapers.lua

function make_static() {
  if [[ -f $STATIC_FILE ]]; then
    echo "Already frozen! $STATIC_FILE exists"
  else
    touch $STATIC_FILE
    echo "Wezterm wallpaper will not rotate"
  fi

  exit 0
}

function touch_config() {
  if [[ ! -s $WALLPAPER_LUA_FILE ]]; then
    echo "WALLPAPER_LUA_FILE ($WALLPAPER_LUA_FILE) does not exist, attempting to generate"
    ~/.config/wezterm/build-wallpapers.rb
  fi
  echo "Rotating Wallpaper..."
  touch $CONFIG_FILE
}

function maybe_touch_config() {
  if [[ -f $STATIC_FILE ]]; then
    echo "Not rotating; $STATIC_FILE exists"
    exit 1
  else
    touch_config
  fi
}

case $1 in
  freeze|static|stop)
    make_static
    echo "hello"
    ;;
  unfreeze|rotate|start|resume)
    if [[ -f $STATIC_FILE ]]; then
      rm $STATIC_FILE
    fi
    echo "wallpaper unfrozen"
    maybe_touch_config
    ;;
  help|\?)
    echo "WezTerm Wallpaper Rotation Tool"
    echo "USAGE"
    echo "  ${0:t} [freeze|static|stop]    - Temporarily stop wallpaper rotation"
    echo "  ${0:t} [unfreeze|resume|start] - Resume wallpaper rotation"
    ;;
  force)
    touch_config
    ;;
  *)
    maybe_touch_config
    ;;
esac

